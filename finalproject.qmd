---
title: "Final Project"
author: "Christina Yu, Damian Kim"
format: pdf
---


## Read in the data

```{r read-data}
library(tidyverse) 
library(ggfortify)
library(knitr)
library(broom)
library(patchwork)
library(tidymodels)
library(corrplot)
data <- read_csv("data/movies.csv")
```

## Introduction and data

Nowadays, movie industries are definitely one of the most popular things for people, especially movie investors to look at.  There are more factors that intervene in this
kind of thing, like actors, genres, user ratings and more

This dataset was scraped from IMDb (Internet Movie Database). There are 6820 movies in the dataset (220 movies per year, 1986-2016). Each movie has the following attributes:

-- `budget`: the budget of a movie. Some movies don't have this, so it appears as 0

-- `company`: the production company

-- `director`: the director

-- `genre`: main genre of the movie.

-- `gross`: revenue of the movie

-- `name`: name of the movie

-- `rating`: rating of the movie (R, PG, etc.)

-- `released`: release date (YYYY-MM-DD)

-- `runtime`: duration of the movie

--  `score`: IMDb user rating

-- `votes`: number of user votes

-- `star`: main actor/actress

-- `writer`: writer of the movie

-- `year`: year of release

We will explore the factors that make a movie successful through examining the effects of `gross`, `budget`, `genre`, `rating`,`score` `votes`, `year`, and `runtime` for individual movie. 

Since the dataset includes movies that are not missing or not published yet (therefore their gross values are missing), we filtered the dataset to include only observations with gross values not being NULL, as it does not make sense to include the movies that are not actually performed or lost real data in our analysis. We filter all the null values for the rest of predictor variables as well. Now we have 5423 observations in the dataset.

```{r filter-data}
data <- data %>%
  filter(!is.na(gross) & !is.na(budget) & !is.na(genre) & !is.na(rating) & !is.na(score) & !is.na(votes) & !is.na(year) & !is.na(runtime))
```

## The Predictor Variables
We will use `budget`, `genre`, `rating`,`score` `votes`, `year`, and `runtime` as predictors. Among them, `budget`, `score` `votes`, `year`, and `runtime` are numerical variables, while `genre`and `rating` is a categorical variable.

## The Response Variable
1. Summary of the `gross` variable: 
```{r vis-gross}
data %>% 
  summarise(mean_gross = mean(gross),
            median_gross = median(gross),
            sd_gross = sd(gross),
            min_gross = min(gross),
            max_gross = max(gross)) %>% 
  kable()
```


2. Log-transformation and Distribution of the `gross` variable: 
```{r distribution-gross}
data <- data %>% 
  mutate(log_gross = log(gross)) %>%
  mutate(mean = mean(log_gross)) 

p1 <- ggplot(data = data, aes(x = gross))+
  geom_histogram(fill = "light blue", color = "black")+
  labs(title = "Distribution of Movies' Gross",
       x = "Gross")
p2 <- ggplot(data = data, aes(x = log_gross))+
  geom_histogram(fill = "light blue", color = "black")+
  labs(x = "Log (Gross)")
p1/p2

```
```{r gross-distributions, message = F, warning = F}
ggplot(data = data) + 
  geom_boxplot(aes(y = gross, color = genre)) +
  labs(title = "Gross", 
       color = "Genre")

ggplot(data = data) + 
  geom_boxplot(aes(y = log_gross, color = genre)) +
  labs(title = "Log Gross", 
       color = "Genre")
```


Since the response variable is significantly right skewed, we apply a log-transformation to it and will use log(gross) as our new response variable in the future analysis. Now, our response variable is unimodal, roughly a normal distribution, with the mean at 17.2102, and several outliers at left tail. 

3. Relationship between Gross and Budget based on different Genres: 
```{r relationship-gross-budget-genres, message = F, warning = F}
ggplot(data = data, aes(x=budget, y = log_gross, color = rating))+
  geom_point(size=0.5, fill=NA) +
  geom_smooth(fill=NA) +
  theme(legend.key.size = unit(0.3, "cm")) +
  facet_wrap(~ genre)+
  ggtitle("Relationship between Budget and Gross by Rating across Genres") +
  xlab("Budget") +
  ylab("Log(Gross)")+
  scale_color_discrete(name = "Rating", guide = guide_legend(override.aes = list(size = 1)))+
  theme(panel.spacing.x = unit(2, "mm"))
```
We observe that the relationship between budget and gross is vastly different across genres: Action, adventure, animation movies have a steep slope and generally high budget spans, with outliers which have exceedingly high budget and relatively high gross values. On the other hand, genres such as horror, mystery and romance have a much flatter slope, which corresponds to the industry knowledge that certain genres are more conducive to low-budget film making than others. Therefore, we're interested in further exploring the relationship between budget, genre, and our response variable.

## EDA: Visualizatioins and Summary Statistics
Since the dataset contains many interesting variables that we want to explore. We first do some EDA on our datasets to show potential problems that we can explore further into. 

```{r numeric-variable-distributions, message = F, warning = F}
ggplot(data = data) + 
  geom_boxplot(aes(y = year, color = genre)) +
  labs(title = "Year", 
       color = "Genre")

ggplot(data = data) + 
  geom_boxplot(aes(y = score, color = genre)) +
  labs(title = "Score", 
       color = "Genre")

ggplot(data = data) + 
  geom_boxplot(aes(y = votes, color = genre)) +
  labs(title = "Votes", 
       color = "Genre")

ggplot(data = data) + 
  geom_boxplot(aes(y = budget, color = genre)) +
  labs(title = "Budget", 
       color = "Genre")

ggplot(data = data) + 
  geom_boxplot(aes(y = runtime, color = genre)) +
  labs(title = "Runtimes", 
       color = "Genre")

```


```{r interesting-relationships, message = F, warning = F}
ggplot(data = data, aes(x = runtime, y = gross)) + 
  geom_point() +
  labs(title = "Runtime has no relationship with Gross")

data2 <- data %>% 
  mutate(log_votes = log(votes)) 

ggplot(data = data2, aes(x = log_votes, y = score)) + 
  geom_point() +
  labs(title = "Log of votes has a converging, positive relationship with Score")
```

```{r correlation-matrix, message = F, warning = F}

numeric_data <- data |> 
  select("score", "votes", "budget", "gross", "runtime")
corrplot(cor(numeric_data))

```


## Methodology

As a potential movie investor, we're curious about the prediction of movies' gross based on all the variables we're interested in. We're very curious about the factors that affect success(gross) of the movie. Therefore, we want to explore the following subquestions in order for us to gain a better understanding of 1) Prediction of movies' gross value; and 2) the factors that affect the success of the movie.

## Linear Regression of all variables
Based on the above violations, we want to apply linear mixed model to our datasets to further explore our questions. We want to 

```{r regression-variables, message = F, warning = F}
m1 <- lm(log_gross ~ budget + genre + rating + score + votes + year + runtime, data = data)
m1_aug <- augment(m1)
summary(m1)
```


## Residual plots/Assumptions
```{r residual-plot, message = F, warning = F}
ggplot(m1_aug, aes(x = .fitted, y = .resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "darkred") + 
  labs(x = "Fitted (predicted) value", y = "Residual") + 
  theme_bw()
```
We can see that the linear assumption is violated since the data is not symmetrically distributed observations around the horizontal axis. We may assume that the dataset has some independence. For example, the movie with the same director or writer, or the star in the movie may lead to higher budget or gross values, such that this movie-specific relatioinship violates independence.

## Linear Mixed Model & Random Effect
Based on the above violations, we want to apply linear mixed model to our datasets to further explore our questions. We want to look at the assiociations between our interested variables, and random  effect due to country. 

```{r random-effect, message = F, warning = F}
 
```

## Hypothesis Test 1:
Question 1: Is there evidence to suggest that Budget has an effect on the success of the movies?
Null hypothesis: $p_1 = 0 $ There isn't sufficient evidence to suggest that budget is associated with movies' gross, while controlling for all of the variables.
Alternative hypothesis: $p_1 ≠ 0 $ There is sufficient evidence to suggest that budget is associated with movies' gross, while controlling for all of the variables.

We use significance level of 0.05. Since the t-statistics is 23.227 and the p-value is < 2e-16 which is much smaller than our significance level, so we reject the null hypothesis since there's sufficient evidence, and thus there's sufficient evidence to suggest to budget does have an effect on the success of the movies. 

## Hypothesis Test 2:
Aim 2: Is there evidence to suggest that Genre has an effect on the success of the movies?
Null hypothesis:  $p_2 = 0 $ There isn't sufficient evidence to suggest that Genre is associated with movies' gross, while controlling for all of the variables.
Alternative hypothesis: $p_2 ≠ 0 $ There is sufficient evidence to suggest that Genre is associated with movies' gross, while controlling for all of the variables.

We use significance level of 0.05. Since the t-statistics is 23.227 and the p-value is < 2e-16 which is much smaller than our significance level, so we reject the null hypothesis since there's sufficient evidence, and thus there's sufficient evidence to suggest to budget does have an effect on the success of the movies. 

## LASSO:
```{r lasso, message = F, warning = F}
set.seed(919)
library(glmnet)

```

## Ridge: 
```{r ridge, message = F, warning = F}
 
```
## Predicting moves' gross
```{r prediction-gross, message = F, warning = F}
 
```

## Missing Data Analysis:


## Results
Explain the reasoning for the type of model you’re fitting, predictor variables considered for the model including any interactions. Additionally, show how you arrived at the final model by describing the model selection process, interactions considered, variable transformations (if needed), assessment of conditions and diagnostics, and any other relevant considerations that were part of the model fitting process.


## Discussion 
Summary + statistical arguments to support my conclusions + future limitations/future ideads